<!DOCTYPE html>
<html>
<head>
    <title>Raspberry Pi Real-Time Monitoring</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- ページ遷移ボタン -->
    <div style="text-align: center; margin-bottom: 20px;">
        <button onclick="location.href='/request-history'">Go to Request Page</button>
    </div>
    <h1>Raspberry Pi Real-Time Monitoring</h1>
    <canvas id="lineChart" width="800" height="400"></canvas>
    <script>
        const ctx = document.getElementById("lineChart").getContext("2d");

        // 初期グラフデータ
        const chartData = {
            labels: [],
            datasets: [
                {
                    label: "Temperature ('C)",
                    borderColor: "red",
                    fill: false,
                    data: [],
                },
                {
                    label: "CPU Usage (%)",
                    borderColor: "blue",
                    fill: false,
                    data: [],
                },
            ],
        };

        const config = {
            type: "line",
            data: chartData,
            options: {
                responsive: true,
                scales: {
                    x: { title: { display: true, text: "Time" } },
                    y: { title: { display: true, text: "Value" } },
                },
            },
        };

        const lineChart = new Chart(ctx, config);

        // 定期的にデータを取得してグラフを更新
        function fetchData() {
            fetch("/api/live-data")
                .then((response) => response.json())
                .then((data) => {
                    const labels = data.map((item) => item.timestamp);
                    const temperature = data.map((item) => item.temperature);
                    const cpuUsage = data.map((item) => item.cpu_usage);

                    // グラフデータを更新
                    lineChart.data.labels = labels;
                    lineChart.data.datasets[0].data = temperature;
                    lineChart.data.datasets[1].data = cpuUsage;
                    lineChart.update();
                })
                .catch((error) => console.error("Error fetching data:", error));
        }

        // 5秒ごとにデータ更新
        setInterval(fetchData, 5000);

        // 初期データ取得
        fetchData();
    </script>
</body>
</html>
